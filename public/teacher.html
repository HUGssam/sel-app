<!-- teacher.html (일부분만 변경된 최종본 전체 제공) -->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>SEL 결과 - 교사용</title>
<style>
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #2c6cf6; color: white; }
  textarea { width: 95%; height: 60px; }
  button { padding: 5px 10px; }
</style>
</head>
<body>
<h1>사회정서학습(SEL) 진단 결과 - 교사용</h1>

<div>
  <label>학년 그룹</label>
  <select id="gradeGroup">
    <option value="">전체</option>
    <option value="34">3-4학년</option>
    <option value="56">5-6학년</option>
  </select>

  <label>반/번호</label>
  <input id="studentCode" placeholder="예: 3-1-02">
  <button onclick="loadResults()">조회</button>
</div>

<table id="resultTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>코드</th>
      <th>학년그룹</th>
      <th>종신호등</th>
      <th>세부 정보 (지도 포인트)</th>
      <th>응시시간</th>
      <th>저장</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function loadResults() {
  const gradeGroup = document.getElementById("gradeGroup").value;
  const studentCode = document.getElementById("studentCode").value;

  const res = await fetch(`/api/sel/results?gradeGroup=${gradeGroup}&studentCode=${studentCode}`);
  const data = await res.json();

  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  data.forEach(r => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.student_code}</td>
      <td>${r.grade_group}</td>
      <td>${r.overall_level}</td>
      <td>
        <textarea id="detail_${r.id}" placeholder="예: 자기조절 역량 강화 필요">${r.detail || ""}</textarea>
      </td>
      <td>${new Date(r.created_at).toLocaleString()}</td>
      <td><button onclick="saveDetail(${r.id})">저장</button></td>
    `;

    tbody.appendChild(tr);
  });
}

async function saveDetail(id) {
  const detail = document.getElementById(`detail_${id}`).value;

  await fetch("/api/sel/updateDetail", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, detail })
  });

  alert("저장되었습니다!");
}
</script>
</body>
</html>
